/* Task Extension Styles */

/* Checkbox Wrapper and Input */
.cm-task-checkbox-wrapper {
  display: inline-block;
  margin-right: 4px;
  vertical-align: middle;
  position: relative;
  z-index: 2;
  pointer-events: auto;
}

.cm-task-checkbox {
  width: 16px;
  height: 16px;
  margin: 0;
  padding: 0;
  cursor: pointer;
  border: 2px solid var(--color-border, #d1d5db);
  border-radius: 4px;
  background: var(--color-bg-primary, white);
  transition: all 0.2s ease;
  -webkit-appearance: none;
  appearance: none;
  position: relative;
  top: 2px;
}

.cm-task-checkbox:hover {
  border-color: var(--color-primary, #3b82f6);
  transform: scale(1.05);
}

/* Checkbox States */
.cm-task-checkbox.cm-task-done {
  background: var(--color-success, #10b981);
  border-color: var(--color-success, #10b981);
}

.cm-task-checkbox.cm-task-done::after {
  content: '✓';
  position: absolute;
  top: -2px;
  left: 2px;
  color: white;
  font-size: 12px;
  font-weight: bold;
}

.cm-task-checkbox.cm-task-cancelled {
  background: var(--color-muted, #6b7280);
  border-color: var(--color-muted, #6b7280);
}

.cm-task-checkbox.cm-task-cancelled::after {
  content: '−';
  position: absolute;
  top: -4px;
  left: 3px;
  color: white;
  font-size: 14px;
  font-weight: bold;
}

/* Task Line Styles */
.cm-task-line {
  position: relative;
  padding-left: 2px;
}

/* Clickable task lines - indicate they're interactive */
.cm-task-clickable {
  cursor: pointer;
  transition: background-color 0.2s;
}

.cm-task-clickable:hover {
  background-color: rgba(0, 0, 0, 0.02);
}

/* Edit mode indicator - shows raw markdown */
.cm-task-line.cm-task-edit-mode {
  background-color: rgba(59, 130, 246, 0.05);
  border-left: 3px solid var(--color-primary, #3b82f6);
  padding-left: 5px;
  position: relative;
}

/* In edit mode, always hide preview checkbox/pills if any remnants remain */
.cm-task-line.cm-task-edit-mode .cm-task-checkbox-wrapper { display: none !important; }
.cm-task-line.cm-task-edit-mode .cm-task-chip { display: none !important; }
.cm-task-line.cm-task-edit-mode .cm-task-clickable { pointer-events: none !important; }

/* Edit mode content styling */
.cm-task-edit-mode-content {
  background-color: rgba(59, 130, 246, 0.02);
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 0.95em;
}

/* Edit mode indicator badge */
.cm-task-line.cm-task-edit-mode::before {
  content: 'EDIT';
  position: absolute;
  right: 8px;
  top: 2px;
  font-size: 10px;
  font-weight: 600;
  color: var(--color-primary, #3b82f6);
  background: rgba(59, 130, 246, 0.1);
  padding: 2px 6px;
  border-radius: 3px;
  letter-spacing: 0.5px;
}

.cm-task-line.cm-task-done {
  opacity: 0.7;
}

.cm-task-line.cm-task-done .cm-content {
  text-decoration: line-through;
  color: var(--color-text-muted, #6b7280);
}

.cm-task-line.cm-task-cancelled {
  opacity: 0.6;
}

.cm-task-line.cm-task-cancelled .cm-content {
  text-decoration: line-through;
  font-style: italic;
  color: var(--color-text-muted, #6b7280);
}

/* Property Chips */
.cm-task-chip {
  display: inline-block;
  padding: 2px 6px;
  margin: 0 2px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 500;
  vertical-align: middle;
  white-space: nowrap;
  cursor: default;
  transition: all 0.2s ease;
}

.cm-task-chip:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Due Date Chip */
.cm-task-chip-due {
  background: var(--color-info-bg, #dbeafe);
  color: var(--color-info-text, #1e40af);
  border: 1px solid var(--color-info-border, #93c5fd);
}

/* Priority Chips */
.cm-task-chip-priority {
  font-weight: 600;
}

.cm-task-chip-priority[title*="high"] {
  background: var(--color-danger-bg, #fee2e2);
  color: var(--color-danger-text, #991b1b);
  border: 1px solid var(--color-danger-border, #fca5a5);
}

.cm-task-chip-priority[title*="med"] {
  background: var(--color-warning-bg, #fef3c7);
  color: var(--color-warning-text, #92400e);
  border: 1px solid var(--color-warning-border, #fde047);
}

.cm-task-chip-priority[title*="low"] {
  /* Use light blue for low priority */
  background: var(--color-info-bg, #dbeafe);
  color: var(--color-info-text, #1e40af);
  border: 1px solid var(--color-info-border, #93c5fd);
}

/* Project Chip */
.cm-task-chip-project {
  background: var(--color-secondary-bg, #f3e8ff);
  color: var(--color-secondary-text, #6b21a8);
  border: 1px solid var(--color-secondary-border, #d8b4fe);
}

/* Tag Chip */
.cm-task-chip-tag {
  background: var(--color-muted-bg, #f3f4f6);
  color: var(--color-muted-text, #374151);
  border: 1px solid var(--color-muted-border, #d1d5db);
}

/* TID Chip (check icon only) */
/* Hide TID chip entirely (keep comment in raw markdown; not shown in editor) */
.cm-task-chip-tid {
  display: none !important;
}

/* Special styling for #project/<name> nested tags */
.cm-task-chip-tag-project {
  /* Switch to light green to emphasize project tags */
  background: var(--color-success-bg, #dcfce7);
  color: var(--color-success-text, #14532d);
  border: 1px solid var(--color-success-border, #86efac);
}

/* Dark Mode Support */
.dark .cm-task-checkbox {
  background: var(--color-bg-secondary, #1f2937);
  border-color: var(--color-border-dark, #4b5563);
}

.dark .cm-task-clickable:hover {
  background-color: rgba(255, 255, 255, 0.02);
}

.dark .cm-task-line.cm-task-edit-mode {
  background-color: rgba(96, 165, 250, 0.1);
  border-left-color: var(--color-primary-dark, #60a5fa);
}

.dark .cm-task-edit-mode-content {
  background-color: rgba(96, 165, 250, 0.05);
}

.dark .cm-task-line.cm-task-edit-mode::before {
  color: var(--color-primary-dark, #60a5fa);
  background: rgba(96, 165, 250, 0.2);
}

.dark .cm-task-checkbox:hover {
  border-color: var(--color-primary-dark, #60a5fa);
}

.dark .cm-task-chip-due {
  background: rgba(59, 130, 246, 0.1);
  color: #93c5fd;
  border-color: rgba(59, 130, 246, 0.3);
}

.dark .cm-task-chip-priority[title*="high"] {
  background: rgba(239, 68, 68, 0.1);
  color: #fca5a5;
  border-color: rgba(239, 68, 68, 0.3);
}

.dark .cm-task-chip-priority[title*="med"] {
  background: rgba(245, 158, 11, 0.1);
  color: #fde047;
  border-color: rgba(245, 158, 11, 0.3);
}

.dark .cm-task-chip-priority[title*="low"] {
  background: rgba(59, 130, 246, 0.1);
  color: #93c5fd;
  border-color: rgba(59, 130, 246, 0.3);
}

.dark .cm-task-chip-project {
  background: rgba(147, 51, 234, 0.1);
  color: #d8b4fe;
  border-color: rgba(147, 51, 234, 0.3);
}

.dark .cm-task-chip-tag {
  background: rgba(107, 114, 128, 0.1);
  color: #9ca3af;
  border-color: rgba(107, 114, 128, 0.3);
}

.dark .cm-task-chip-tid { display: none !important; }

.dark .cm-task-chip-tag-project {
  /* Dark mode variant for green project tag chips */
  background: rgba(34, 197, 94, 0.16);
  color: #86efac;
  border-color: rgba(34, 197, 94, 0.4);
}

/* Animation for task state changes */
@keyframes taskComplete {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
  }
}

.cm-task-checkbox.cm-task-done {
  animation: taskComplete 0.3s ease;
}

/* Tooltip styles */
.cm-task-tooltip {
  position: absolute;
  background: var(--color-bg-tooltip, #1f2937);
  color: var(--color-text-tooltip, white);
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  pointer-events: none;
  max-width: 300px;
  line-height: 1.4;
}

.cm-task-tooltip::before {
  content: '';
  position: absolute;
  bottom: -4px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid var(--color-bg-tooltip, #1f2937);
}
